<!DOCTYPE html>
<html lang="es">
<head>
        <meta charset="utf-8" />
        <title>virsh</title>
        <link rel="stylesheet" href="../theme/css/main.css" />

        <!--[if IE]>
            <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="../">Introducción al Cloud Computing </a></h1>
                <nav><ul>
                </ul>
                </nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="../virt/virsh.html" rel="bookmark"
           title="Permalink to virsh">virsh</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <span>mar 06 octubre 2020</span>

</footer><!-- /.post-info -->      <p>Virsh es una shell completa para gestionar la API de libvirt. Se puede
usar de forma interactiva o no, pasándole o no directamente las
órdenes correspondientes.</p>
<h2>Conexión al hipervisor</h2>
<p>En el caso de utilizar qemu-kvm localmente, podemos establecer una
conexión no privilegiada con cada usuario del sistema
(<code>qemu:///session</code>) o una privilegiada (<code>qemu:///system</code>)</p>
<div class="highlight"><pre><span></span><span class="nv">virsh</span> <span class="o">-</span><span class="nv">c</span> <span class="nv">qemu</span>:<span class="o">///</span><span class="nv">system</span>
<span class="nv">Welcome</span> <span class="nv">to</span> <span class="nv">virsh</span>, <span class="nv">the</span> <span class="nv">virtualization</span> <span class="nv">interactive</span> <span class="nv">terminal</span>.

<span class="nv">Type</span>:  <span class="s1">&#39;</span><span class="s">help</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="nv">help</span> <span class="nv">with</span> <span class="nv">commands</span>
       <span class="s1">&#39;</span><span class="s">quit</span><span class="s1">&#39;</span> <span class="nv">to</span> <span class="nv">quit</span>

<span class="nv">virsh</span> # 
</pre></div>


<h2>Tipos de órdenes</h2>
<p>Al pasar como parámetro <code>help</code> aparecen las órdenes agrupadas por
tipo:</p>
<div class="highlight"><pre><span></span><span class="n">virsh</span> <span class="n">help</span>
<span class="n">Grouped</span> <span class="n">commands</span><span class="p">:</span>

 <span class="k">Domain</span> <span class="n">Management</span> <span class="p">(</span><span class="n">help</span> <span class="n">keyword</span> <span class="s1">&#39;domain&#39;</span><span class="p">):</span>
    <span class="n">attach</span><span class="o">-</span><span class="n">device</span>                  <span class="n">attach</span> <span class="n">device</span> <span class="k">from</span> <span class="n">an</span> <span class="n">XML</span> <span class="n">file</span>
    <span class="n">attach</span><span class="o">-</span><span class="n">disk</span>                    <span class="n">attach</span> <span class="n">disk</span> <span class="n">device</span>
    <span class="n">attach</span><span class="o">-</span><span class="n">interface</span>               <span class="n">attach</span> <span class="n">network</span> <span class="n">interface</span>
<span class="p">...</span>
</pre></div>


<ul>
<li><em>Domain Management</em> Gestión y modificación de los dominios (MVs)</li>
<li><em>Domain Monitoring</em> Parámetros de ejecución de los dominios</li>
<li><em>Host and Hypervisor</em> Características del hipervisor</li>
<li><em>Interface</em> Interfaces de red</li>
<li><em>Network filter</em> Reglas de iptables</li>
<li><em>Networking</em></li>
<li><em>Node device</em> Dispositivos físicos gestionados por los dominios</li>
<li><em>Secret</em></li>
<li><em>Snapshot</em></li>
<li><em>Storage Pool</em> Gestión de los recursos de almacenamiento</li>
<li><em>Storage Volume</em> Volúmenes</li>
</ul>
<h3>Órdenes disponibles para cada tipo</h3>
<p>Libvirt utiliza el término "dominio" para referirse a la máquina
virtual que se ejecuta sobre el hipervisor, término adoptado de los
sistemas de paravirtualización como Xen. Para obtener las órdenes
disponibles para gestionar dominios:</p>
<div class="highlight"><pre><span></span><span class="n">virsh</span> <span class="n">help</span> <span class="k">domain</span>
 <span class="k">Domain</span> <span class="n">Management</span> <span class="p">(</span><span class="n">help</span> <span class="n">keyword</span> <span class="s1">&#39;domain&#39;</span><span class="p">):</span>
    <span class="n">attach</span><span class="o">-</span><span class="n">device</span>                  <span class="n">attach</span> <span class="n">device</span> <span class="k">from</span> <span class="n">an</span> <span class="n">XML</span> <span class="n">file</span>
    <span class="n">attach</span><span class="o">-</span><span class="n">disk</span>                    <span class="n">attach</span> <span class="n">disk</span> <span class="n">device</span>
    <span class="n">attach</span><span class="o">-</span><span class="n">interface</span>               <span class="n">attach</span> <span class="n">network</span> <span class="n">interface</span>
<span class="p">...</span>
</pre></div>


<h2>Configuración inicial</h2>
<p>Para la creación inicial de una máquina virtual necesitamos definir
una red a la que pueda conectarse y un espacio en el que ubicar el
dispositivo de almacenamiento principal.</p>
<p>Libvirt denomina "pool" de forma genérica a un medio de almacenamiento
disponible, independientemente de su naturaleza, así podemos tener
como pool de almacenamiento un directorio, un grupo de volúmenes de
LVM, un disco duro, un volumen gluster, etc.</p>
<h3>Pool de almacenamiento por defecto</h3>
<p>Si no existe, creamos un pool por defecto en <code>/var/lib/libvirt/images</code>
con el fichero <code>default-pool.xml</code>:</p>
<div class="highlight"><pre><span></span><span class="nt">&lt;pool</span> <span class="na">type=</span><span class="s">&#39;dir&#39;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;name&gt;</span>default<span class="nt">&lt;/name&gt;</span>
  <span class="nt">&lt;target&gt;</span>
    <span class="nt">&lt;path&gt;</span>/var/lib/libvirt/images<span class="nt">&lt;/path&gt;</span>
  <span class="nt">&lt;/target&gt;</span>
<span class="nt">&lt;/pool&gt;</span>
</pre></div>


<p>Y lo añadimos con:</p>
<div class="highlight"><pre><span></span><span class="n">virsh</span> <span class="o">-</span><span class="k">c</span> <span class="n">qemu</span><span class="p">:</span><span class="o">///</span><span class="k">system</span> <span class="n">pool</span><span class="o">-</span><span class="k">create</span> <span class="k">default</span><span class="o">-</span><span class="n">pool</span><span class="p">.</span><span class="n">xml</span>
</pre></div>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <p>Powered by <a href="http://getpelican.com/">Pelican</a>. Theme <a href="https://github.com/blueicefield/pelican-blueidea/">blueidea</a>, inspired by the default theme.</p>
        </footer><!-- /#contentinfo -->

</body>
</html>